DROP VIEW IF EXISTS VW_IFRS_ECL_MODEL_DETAIL_EAD CASCADE;

CREATE VIEW VW_IFRS_ECL_MODEL_DETAIL_EAD
AS
 SELECT A.PKID,
    A.SYSCODE_ECL_CONFIGURATION AS ECL_MODEL_ID,
    A.CODE_SEGMENTATION AS SEGMENTATION_ID,
    A.CODE_EAD_CONFIG AS EAD_MODEL_ID,
    0 AS IS_DELETE,
    A.CREATED_BY AS CREATEDBY,
    A.CREATED_DATE AS CREATEDDATE,
    A.CREATED_HOST AS CREATEDHOST,
    A.UPDATED_BY AS UPDATEDBY,
    A.UPDATED_DATE AS UPDATEDDATE,
    A.UPDATED_HOST AS UPDATEDHOST,
    A.CCF_MODEL_ID,
    'SELECT_DATE'AS CCF_EFF_DATE_OPTION,
    A.CCF_DATE AS CCF_EFF_DATE
   FROM ( SELECT ECLPDMODEL.PKID,
            ECLPDMODEL.SYSCODE_ECL_CONFIGURATION,
            ECLPDMODEL.CODE_SEGMENTATION,
            ECLPDMODEL.CODE_EAD_CONFIG,
			ECLPDMODEL.CCF_MODEL_ID,
            ECLPDMODEL.CREATED_BY,
            ECLPDMODEL.CREATED_DATE,
            ECLPDMODEL.CREATED_HOST,
            ECLPDMODEL.UPDATED_BY,
            ECLPDMODEL.UPDATED_DATE,
            ECLPDMODEL.UPDATED_HOST,
            ECLPDMODEL.CCF_DATE
           FROM dblink('workflow_ntt_impairment'::text, '
			SELECT A.PKID,
					MAX(B.PKID) AS SYSCODE_ECL_CONFIGURATION,
					MAX(C.PKID) AS CODE_SEGMENTATION,
					MAX(D.PKID) AS CODE_EAD_CONFIG,
					MAX(B.PKID) AS CCF_MODEL_ID,
					A.CREATED_BY,
					A.CREATED_DATE, 
					A.CREATED_HOST, 
					A.UPDATED_BY, 
					A.UPDATED_DATE, 
					A.UPDATED_HOST,
					A.CCF_DATE
			FROM "EclEadModel" A
			LEFT JOIN "EclConfiguration" B ON A.SYSCODE_ECL_CONFIGURATION = B.SYSCODE_ECL_CONFIGURATION
			LEFT JOIN "Segmentation" C ON A.CODE_SEGMENTATION = C.SYSCODE_SEGMENTATION
			LEFT JOIN "EadConfiguration" D ON A.CODE_EAD_CONFIGURATION = D.SYSCODE_EAD_CONFIG
         	WHERE A.CCF_DATE IS NOT NULL
			GROUP BY A.PKID,A.CREATED_BY,
					A.CREATED_DATE, 
					A.CREATED_HOST, 
					A.UPDATED_BY, 
					A.UPDATED_DATE, 
					A.UPDATED_HOST,
					A.CCF_DATE'::TEXT) ECLPDMODEL(
					PKID BIGINT, 
					SYSCODE_ECL_CONFIGURATION BIGINT, 
					CODE_SEGMENTATION BIGINT, 
					CODE_EAD_CONFIG BIGINT,
					CCF_MODEL_ID BIGINT,
					CREATED_BY CHARACTER VARYING, 
					CREATED_DATE TIMESTAMP WITHOUT TIME ZONE, 
					CREATED_HOST CHARACTER VARYING, 
					UPDATED_BY CHARACTER VARYING, 
					UPDATED_DATE TIMESTAMP WITHOUT TIME ZONE, 
					UPDATED_HOST CHARACTER VARYING, 
					CCF_DATE TIMESTAMP WITHOUT TIME ZONE)
					) A;