DROP VIEW IF EXISTS VW_IFRS_ECL_MODEL_DETAIL_PF;

CREATE VIEW VW_IFRS_ECL_MODEL_DETAIL_PF
AS

SELECT A.PKID
,SYSCODE_ECL_CONFIGURATION AS ECL_MODEL_ID
,CODE_SEGMENTATION AS SEGMENTATION_ID
,NULL AS LT_RULE_ID
,NULL AS SICR_RULE_ID
,NULL AS UPSIDE_VALUE
,NULL AS BASE_VALUE
,NULL AS DOWNSIDE_VALUE
,NULL AS UPSIDE_PROB_OUTCOME
,NULL AS BASE_PROB_OUTCOME
,NULL AS DOWNSIDE_PROB_OUTCOME
,NULL AS OVERLAY_AMOUNT
,0 AS IS_DELETE
,A.CREATED_BY AS CREATEDBY
,A.CREATED_DATE AS CREATEDDATE
,A.CREATED_HOST AS CREATEDHOST
,A.UPDATED_BY AS UPDATEDBY
,A.UPDATED_DATE AS UPDATEDDATE
,A.UPDATED_HOST AS UPDATEDHOST
,BUCKET_CODE AS BUCKET_GROUP 
,DEFAULT_CRITERIA_CODE AS DEFAULT_RULE_ID FROM (
		SELECT * FROM dblink('workflow_ntt_impairment','
			SELECT A.PKID,
					MAX(B.PKID) AS SYSCODE_ECL_CONFIGURATION,
					MAX(C.PKID) AS CODE_SEGMENTATION,
					A.CREATED_BY,
					A.CREATED_DATE, 
					A.CREATED_HOST, 
					A.UPDATED_BY, 
					A.UPDATED_DATE, 
					A.UPDATED_HOST,
					MAX(E.PKID) AS BUCKET_CODE,
					MAX(F.PKID) AS DEFAULT_CRITERIA_CODE
			FROM "EclPortfolio" A
			LEFT JOIN "EclConfiguration" B ON A.SYSCODE_ECL_CONFIGURATION = B.SYSCODE_ECL_CONFIGURATION
			LEFT JOIN "Segmentation" C ON A.CODE_SEGMENTATION = C.SYSCODE_SEGMENTATION
			LEFT JOIN "PdConfiguration" D ON A.CODE_SEGMENTATION = D.SEGMENT_CODE
			LEFT JOIN "GroupBucket" E ON D.BUCKET_CODE = E.SYSCODE_GROUP_BUCKET
			LEFT JOIN "DefaultCriteria" F ON D.DEFAULT_CRITERIA_CODE = F.SYSCODE_DEFAULT_CRITERIA
			GROUP BY A.PKID,A.CREATED_BY,
					A.CREATED_DATE, 
					A.CREATED_HOST, 
					A.UPDATED_BY, 
					A.UPDATED_DATE, 
					A.UPDATED_HOST')
			ECLPDMODEL(PKID BIGINT,
						SYSCODE_ECL_CONFIGURATION BIGINT,
						CODE_SEGMENTATION BIGINT,
						CREATED_BY CHARACTER VARYING, 
						CREATED_DATE TIMESTAMP WITHOUT TIME ZONE, 
						CREATED_HOST CHARACTER VARYING, 
						UPDATED_BY CHARACTER VARYING, 
						UPDATED_DATE TIMESTAMP WITHOUT TIME ZONE, 
						UPDATED_HOST CHARACTER VARYING,
						BUCKET_CODE BIGINT,
						DEFAULT_CRITERIA_CODE BIGINT)
			) A