DROP VIEW IF EXISTS VW_IFRS_ECL_MODEL_DETAIL_LGD;

CREATE VIEW VW_IFRS_ECL_MODEL_DETAIL_LGD
AS

SELECT A.PKID
,A.SYSCODE_ECL_CONFIGURATION AS ECL_MODEL_ID
,A.SYSCODE_SEGMENTATION AS SEGMENTATION_ID
,A.SYSCODE_LGD_CONFIG AS LGD_MODEL_ID
,NULL ME_MODEL_ID
,A.EFFECTIVE_DATE AS EFF_DATE_OPTION
,A.EFFECTIVE_PERIOD AS EFF_DATE
,0 AS IS_DELETE
,A.CREATED_BY AS CREATEDBY
,A.CREATED_DATE AS CREATEDDATE
,A.CREATED_HOST AS CREATEDHOST
,A.UPDATED_BY AS UPDATEDBY
,A.UPDATED_DATE AS UPDATEDDATE
,A.UPDATED_HOST AS UPDATEDHOST
		FROM (
		SELECT * FROM DBLINK('WORKFLOW_NTT_IMPAIRMENT','
			SELECT A.PKID,
					MAX(B.PKID) AS SYSCODE_ECL_CONFIGURATION,
					MAX(C.PKID) AS SYSCODE_SEGMENTATION,
					MAX(D.PKID) AS SYSCODE_LGD_CONFIG,
					MAX(A.EFFECTIVE_DATE) AS EFFECTIVE_DATE,
					MAX(A.EFFECTIVE_PERIOD) AS EFFECTIVE_PERIOD,
					A.CREATED_BY,
					A.CREATED_DATE, 
					A.CREATED_HOST, 
					A.UPDATED_BY, 
					A.UPDATED_DATE, 
					A.UPDATED_HOST
			FROM "ECLLGDMODEL" A
			LEFT JOIN "ECLCONFIGURATION" B ON A.SYSCODE_ECL_CONFIGURATION = B.SYSCODE_ECL_CONFIGURATION
			LEFT JOIN "SEGMENTATION" C ON A.CODE_SEGMENTATION = C.SYSCODE_SEGMENTATION
			LEFT JOIN "LGDCONFIGURATION" D ON A.CODE_LGD_CONFIGURATION = D.SYSCODE_LGD_CONFIG
			WHERE A.IS_ACTIVE = TRUE
			GROUP BY A.PKID,
					A.CREATED_BY,
					A.CREATED_DATE, 
					A.CREATED_HOST, 
					A.UPDATED_BY, 
					A.UPDATED_DATE, 
					A.UPDATED_HOST')
			ECLPDMODEL(PKID BIGINT,
						SYSCODE_ECL_CONFIGURATION BIGINT,
						SYSCODE_SEGMENTATION BIGINT,
						SYSCODE_LGD_CONFIG BIGINT,
						EFFECTIVE_DATE CHARACTER VARYING,
						EFFECTIVE_PERIOD TIMESTAMP WITHOUT TIME ZONE,
						CREATED_BY CHARACTER VARYING, 
						CREATED_DATE TIMESTAMP WITHOUT TIME ZONE, 
						CREATED_HOST CHARACTER VARYING, 
						UPDATED_BY CHARACTER VARYING, 
						UPDATED_DATE TIMESTAMP WITHOUT TIME ZONE, 
						UPDATED_HOST CHARACTER VARYING)
			) A