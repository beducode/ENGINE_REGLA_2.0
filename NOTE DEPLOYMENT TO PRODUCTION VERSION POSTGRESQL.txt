NOTE DEPLOYMENT
---------------

CREATE EXTENSION IF NOT EXISTS pg_prewarm;      -- preload cache
CREATE EXTENSION IF NOT EXISTS pg_stat_statements; -- monitor query performance
CREATE EXTENSION IF NOT EXISTS pg_buffercache;  -- analisis cache buffer
CREATE EXTENSION IF NOT EXISTS pg_repack;       -- reorg table tanpa downtime
CREATE EXTENSION IF NOT EXISTS pgcrypto;       -- untuk decrypt & encrypt data


ADD TO "postgresql.conf"

shared_preload_libraries = 'pg_prewarm'


-- 1. (dev) enable session (testing)
SET SESSION "google_columnar_engine.enabled" = 'on';

-- 2. create extension
CREATE EXTENSION IF NOT EXISTS google_columnar_engine;

-- 3. add table to columnar engine (if function exists)
SELECT google_columnar_engine_add('public.sales_fact');

-- 4. monitor cache
SELECT google_columnar_engine_storage_cache_used();
SELECT google_columnar_engine_storage_cache_available();

-- 5. check plan
EXPLAIN ANALYZE
SELECT product_id, SUM(amount)
FROM public.sales_fact
WHERE sale_date >= '2025-01-01'
GROUP BY product_id;
