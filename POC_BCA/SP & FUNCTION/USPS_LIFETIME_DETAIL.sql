CREATE OR REPLACE PROCEDURE USPS_LIFETIME_DETAIL
(
    V_PERIOD DATE DEFAULT '2000-01-01',
    V_SegmentationId Number DEFAULT 0,
    Cur_out OUT SYS_REFCURSOR
)
AS
BEGIN

    OPEN Cur_out FOR
    SELECT DISTINCT
           A.DOWNLOAD_DATE,
           A.ACCOUNT_NUMBER,
           A.CUSTOMER_NUMBER,
           A.CUSTOMER_NAME,
           A.LOAN_START_DATE,
           A.END_DATE,
           A.NPL_DATE,
           A.DAY_PAST_DUE_DATE,
           A.LIFETIME_PERIOD
    FROM IFRS_LIFETIME_DETAIL A
    JOIN  IFRS_LIFETIME_HEADER B
    ON A.SEGMENTATION_ID = B.LIFETIME_SEGMENT_ID
    WHERE A.SEGMENTATION_ID = V_SegmentationId
    AND A.DOWNLOAD_DATE <= V_PERIOD
    ORDER BY A.DOWNLOAD_DATE DESC;

END;