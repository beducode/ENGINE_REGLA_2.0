CREATE OR REPLACE PROCEDURE USPS_CCF_MODEL_DETAILS
(
    V_CCF_MODEL_ID NUMBER DEFAULT 0,
    V_CCF_FACILTY_NUMBER NUMBER DEFAULT 0,
    Cur_out OUT SYS_REFCURSOR
)
AS
BEGIN

    OPEN Cur_out FOR
        SELECT B.ACCOUNT_NUMBER,
            B.FIRST_NPL_DATE,
            SUM(B.OS_CUR) AS OUTSTANDING,
            'IDR' AS CURRENCY
        FROM IFRS_CCF_HEADER A
            JOIN IFRS_CCF_DETAIL B ON B.SEGMENTATION_ID = A.SEGMENTATION_ID
        WHERE B.FACILITY_NUMBER = V_CCF_FACILTY_NUMBER
            AND A.CCF_RULE_ID = V_CCF_MODEL_ID
        GROUP BY B.ACCOUNT_NUMBER,
            B.FIRST_NPL_DATE;

END;