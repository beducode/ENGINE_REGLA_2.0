CREATE OR REPLACE PROCEDURE SP_IFRS_DCF_CALCULATION(v_UploadId IN number)
AS
    v_maxdate DATE;
    v_currdate DATE;
    v_date     DATE;
    v_end      NUMBER(10);
    v_start    NUMBER(10);
BEGIN
    EXECUTE IMMEDIATE 'TRUNCATE TABLE GTMP_TBLU_DCF_BULK';

    INSERT INTO GTMP_TBLU_DCF_BULK
    (
        UPLOADID,
        OVERRIDEID,
        ROW_NUMBER,
        CUSTOMER_NUMBER,
        FACILITY_NUMBER,
        ACCOUNT_NUMBER,
        MASTERID,
        ESTIMATED_REALIZE_DATE,
        ESTIMATED_INT_AMOUNT,
        ESTIMATED_PRIN_AMOUNT,
        ESTIMATED_AMOUNT,
        ESTIMATED_COLL_AMOUNT,
        ESTIMATED_CF_PERCENT,
        DISCOUNT_RATE,
        CURRENCY,
        EIR,
        INTEREST_RATE,
        EAD_AMOUNT,
        CR_STAGE,
        BI_COLLECTABILITY,
        PRODUCT_ENTITY,
        RATING_CODE,
        DAY_PAST_DUE,
        IMPAIRED_FLAG,
        OUTSTANDING,
        REMARKS,
        RESERVED_VARCHAR_1,
        RESERVED_VARCHAR_2,
        RESERVED_VARCHAR_3,
        RESERVED_VARCHAR_4,
        RESERVED_VARCHAR_5,
        RESERVED_AMOUNT_1,
        RESERVED_AMOUNT_2,
        RESERVED_AMOUNT_3,
        RESERVED_AMOUNT_4,
        RESERVED_AMOUNT_5,
        RESERVED_RATE_1,
        RESERVED_RATE_2,
        RESERVED_RATE_3,
        RESERVED_RATE_4,
        RESERVED_RATE_5,
        RESERVED_FLAG_1,
        RESERVED_FLAG_2,
        RESERVED_FLAG_3,
        RESERVED_FLAG_4,
        RESERVED_FLAG_5,
        RESERVED_DATE_1,
        RESERVED_DATE_2,
        RESERVED_DATE_3,
        RESERVED_DATE_4,
        RESERVED_DATE_5,
        CREATEDBY,
        CREATEDDATE,
        CREATEDHOST,
        UPDATEDBY,
        UPDATEDDATE,
        UPDATEDHOST
    )
    SELECT A.UPLOADID,
        A.OVERRIDEID,
        A.ROW_NUMBER,
        A.CUSTOMER_NUMBER,
        A.FACILITY_NUMBER,
        A.ACCOUNT_NUMBER,
        A.MASTERID,
        A.ESTIMATED_REALIZE_DATE,
        A.ESTIMATED_INT_AMOUNT,
        A.ESTIMATED_PRIN_AMOUNT,
        A.ESTIMATED_AMOUNT,
        A.ESTIMATED_COLL_AMOUNT,
        A.ESTIMATED_CF_PERCENT,
        CASE WHEN B.DATA_SOURCE IN ('RAKNOS', 'KTP') AND COALESCE(A.DISCOUNT_RATE_TRS,0) > 0 THEN
            COALESCE(A.DISCOUNT_RATE_TRS,0)
        WHEN B.DATA_SOURCE IN ('BTRD') AND COALESCE(A.DISCOUNT_RATE_TRF,0) > 0 THEN
            COALESCE(A.DISCOUNT_RATE_TRF,0)
        WHEN COALESCE(B.EIR,0) > 0 THEN
            COALESCE(B.EIR,0)
        ELSE
            COALESCE(B.INTEREST_RATE,0)
        END DISCOUNT_RATE,
        B.CURRENCY,
        COALESCE(B.EIR,0),
        COALESCE(B.INTEREST_RATE,0),
        B.EAD_AMOUNT,
        B.CR_STAGE,
        B.BI_COLLECTABILITY,
        B.PRODUCT_ENTITY,
        B.RATING_CODE,
        B.DAY_PAST_DUE,
        B.IMPAIRED_FLAG,
        B.OUTSTANDING,
        B.REMARKS,
        B.RESERVED_VARCHAR_1,
        B.RESERVED_VARCHAR_2,
        B.RESERVED_VARCHAR_3,
        B.RESERVED_VARCHAR_4,
        B.RESERVED_VARCHAR_5,
        B.RESERVED_AMOUNT_1,
        B.RESERVED_AMOUNT_2,
        B.RESERVED_AMOUNT_3,
        B.RESERVED_AMOUNT_4,
        B.RESERVED_AMOUNT_5,
        B.RESERVED_RATE_1,
        B.RESERVED_RATE_2,
        B.RESERVED_RATE_3,
        B.RESERVED_RATE_4,
        B.RESERVED_RATE_5,
        B.RESERVED_FLAG_1,
        B.RESERVED_FLAG_2,
        B.RESERVED_FLAG_3,
        B.RESERVED_FLAG_4,
        B.RESERVED_FLAG_5,
        B.RESERVED_DATE_1,
        B.RESERVED_DATE_2,
        B.RESERVED_DATE_3,
        B.RESERVED_DATE_4,
        B.RESERVED_DATE_5,
        B.CREATEDBY,
        B.CREATEDDATE,
        B.CREATEDHOST,
        B.UPDATEDBY,
        B.UPDATEDDATE,
        B.UPDATEDHOST
        FROM TBLU_DCF_DETAIL A
    JOIN IFRS_IA_OVERRIDED B
    ON A.OVERRIDEID = B.OVERRIDEID
    AND A.ACCOUNT_NUMBER = B.ACCOUNT_NUMBER
    AND A.UPLOADID = v_UploadId;

    COMMIT;

    SELECT MAX(A.EXPECTED_PERIOD), MAX(A.EFFECTIVE_DATE), MAX(A.EFFECTIVE_DATE)
    INTO v_maxDate, v_currdate, v_date
    FROM TBLU_DCF_BULK A
    WHERE UPLOADID = v_UploadId;

    SELECT MONTHS_BETWEEN(v_maxDate, v_currdate)
    INTO v_end FROM DUAL;

    v_start := 0;

    EXECUTE IMMEDIATE 'TRUNCATE TABLE GTMP_TBLT_PAYMENTEXPECTED';

    WHILE v_start <= v_end LOOP

        INSERT INTO GTMP_TBLT_PAYMENTEXPECTED
        (
            SEQ,
            CUSTOMER_NUMBER,
            ACCOUNT_NUMBER,
            CURRENCY,
            PAYMENT_DATE,
            DISCOUNT_RATE,
            OUTSTANDING,
            ESTIMATED_CF_PERCENT,
            ESTIMATED_CF_AMOUNT
        )
        SELECT v_start,
            A.CUSTOMER_NUMBER,
            A.ACCOUNT_NUMBER,
            A.CURRENCY,
            FN_LAST_WORKING_DAY(v_date) AS PAYMENT_DATE,
            A.DISCOUNT_RATE,
            A.OUTSTANDING,
            0 ESTIMATED_CF_PERCENT,
            0 ESTIMATED_CF_AMOUNT
        FROM
        (
                SELECT CUSTOMER_NUMBER,
                    ACCOUNT_NUMBER,
                    CURRENCY,
                    DISCOUNT_RATE,
                    OUTSTANDING,
                    MIN(ESTIMATED_REALIZE_DATE) AS MIN_ESTIMATED_REALIZE_DATE
                FROM GTMP_TBLU_DCF_BULK
                WHERE ESTIMATED_REALIZE_DATE >= v_date
                AND NVL(RESERVED_VARCHAR_1,' ') != 'ACCOUNT DETAIL UNCHANGED'
                OR (EXTRACT(YEAR FROM ESTIMATED_REALIZE_DATE) = EXTRACT(YEAR FROM v_date)
                    AND EXTRACT(MONTH FROM ESTIMATED_REALIZE_DATE) = EXTRACT(MONTH FROM v_date))
                GROUP BY CUSTOMER_NUMBER,
                    ACCOUNT_NUMBER,
                    CURRENCY,
                    DISCOUNT_RATE,
                    OUTSTANDING
        ) A;

        COMMIT;

        v_start := v_start + 1;

        v_date := LAST_DAY(ADD_MONTHS(v_date, 1));
    END LOOP;

    MERGE INTO GTMP_TBLT_PAYMENTEXPECTED A
    USING
    (
        SELECT A.CUSTOMER_NUMBER,
            EXTRACT (MONTH FROM EXPECTED_PERIOD) M_EXPECTED_PERIOD,
            EXTRACT (YEAR FROM EXPECTED_PERIOD) Y_EXPECTED_PERIOD,
            SUM(EXPECTED_CF_PERCENT) SUM_ESTIMATED_CF_PERCENT
        FROM TBLU_DCF_BULK A
        WHERE UPLOADID = v_UploadId
        GROUP BY A.CUSTOMER_NUMBER,
            EXTRACT (MONTH FROM EXPECTED_PERIOD),
            EXTRACT (YEAR FROM EXPECTED_PERIOD)
    ) B
    ON
    (   A.CUSTOMER_NUMBER = B.CUSTOMER_NUMBER
        AND EXTRACT (MONTH FROM A.PAYMENT_DATE) = B.M_EXPECTED_PERIOD
        AND EXTRACT (YEAR FROM A.PAYMENT_DATE) = B.Y_EXPECTED_PERIOD
    )
    WHEN MATCHED THEN
    UPDATE SET
        A.ESTIMATED_CF_PERCENT = B.SUM_ESTIMATED_CF_PERCENT,
        A.ESTIMATED_CF_AMOUNT = A.OUTSTANDING * B.SUM_ESTIMATED_CF_PERCENT / 100;

    COMMIT;

    UPDATE GTMP_TBLT_PAYMENTEXPECTED
    SET PV_ESTIMATED_CF_AMOUNT = (1 / POWER( 1 + NVL(DISCOUNT_RATE,0)/12/100, SEQ) * NVL(ESTIMATED_CF_AMOUNT,0));

    COMMIT;

    MERGE INTO GTMP_TBLT_PAYMENTEXPECTED A
    USING
    (SELECT CUSTOMER_NUMBER,
        ACCOUNT_NUMBER,
        SUM(NVL(PV_ESTIMATED_CF_AMOUNT,0)) SUM_PV_ESTIMATED_CF_AMOUNT
        FROM GTMP_TBLT_PAYMENTEXPECTED
       GROUP BY CUSTOMER_NUMBER,
        ACCOUNT_NUMBER
    ) B
    ON (A.CUSTOMER_NUMBER = B.CUSTOMER_NUMBER
        AND A.ACCOUNT_NUMBER = B.ACCOUNT_NUMBER
        AND A.SEQ = 0)
    WHEN MATCHED THEN
    UPDATE SET
        A.BEGINNING_CF_BALANCE = NVL(B.SUM_PV_ESTIMATED_CF_AMOUNT,0),
        A.UNWINDING_INCOME = 0,
        A.ENDING_CF_BALANCE = NVL(B.SUM_PV_ESTIMATED_CF_AMOUNT,0) + NVL(A.ESTIMATED_CF_AMOUNT,0)  ;

    COMMIT;

    v_start := 1;

    WHILE v_start <= v_end LOOP

        MERGE INTO GTMP_TBLT_PAYMENTEXPECTED A
        USING GTMP_TBLT_PAYMENTEXPECTED B
        ON (A.ACCOUNT_NUMBER = B.ACCOUNT_NUMBER AND A.SEQ = v_start AND B.SEQ = v_start - 1)
        WHEN MATCHED THEN
        UPDATE SET
            A.BEGINNING_CF_BALANCE = NVL(B.ENDING_CF_BALANCE,0),
            A.UNWINDING_INCOME = NVL(A.DISCOUNT_RATE,0) / 100 * NVL(B.ENDING_CF_BALANCE,0) / 12,
            A.ENDING_CF_BALANCE = NVL(B.ENDING_CF_BALANCE,0) + (NVL(A.DISCOUNT_RATE,0) / 100 * NVL(B.ENDING_CF_BALANCE,0) / 12) - NVL(A.ESTIMATED_CF_AMOUNT,0);
        COMMIT;

        v_start := v_start + 1;

    END LOOP;

    MERGE INTO GTMP_TBLT_PAYMENTEXPECTED A
    USING
    (
        SELECT CUSTOMER_NUMBER,
            ACCOUNT_NUMBER,
            MAX(SEQ) MAX_SEQ
        FROM GTMP_TBLT_PAYMENTEXPECTED
        GROUP BY CUSTOMER_NUMBER,
            ACCOUNT_NUMBER
    ) B
    ON (A.CUSTOMER_NUMBER = B.CUSTOMER_NUMBER
         AND A.ACCOUNT_NUMBER = B.ACCOUNT_NUMBER
         AND A.SEQ = B.MAX_SEQ)
    WHEN MATCHED THEN
    UPDATE SET
    A.ENDING_CF_BALANCE = 0;

    COMMIT;

    INSERT INTO TBLT_PAYMENTEXPECTED
    (
        OVERRIDEID,
        EFFECTIVE_DATE,
        CUSTOMER_NUMBER,
        FACILITY_NUMBER,
        ACCOUNT_NUMBER,
        MASTERID,
        CURRENCY,
        ESTIMATED_REALIZE_DATE,
        ESTIMATED_PRIN_AMOUNT,
        ESTIMATED_INT_AMOUNT,
        ESTIMATED_COLL_AMOUNT,
        ESTIMATED_AMOUNT,
        DISCOUNT_RATE,
        EIR,
        INTEREST_RATE,
        PV_MONTH,
        PV_AMOUNT,
        ECL_AMOUNT,
        BEGIN_BALANCE,
        INTEREST_UNWINDING,
        ENDING_BALANCE,
        UNWIND_BALANCE,
        CREATEDBY,
        CREATEDDATE,
        CREATEDHOST,
        UPDATEDBY,
        UPDATEDDATE,
        UPDATEDHOST
    )
    SELECT DISTINCT
        B.OVERRIDEID,
        v_currdate EFFECTIVE_DATE,
        B.CUSTOMER_NUMBER,
        B.FACILITY_NUMBER,
        B.ACCOUNT_NUMBER,
        B.MASTERID,
        B.CURRENCY,
        A.PAYMENT_DATE ESTIMATED_REALIZE_DATE,
        NVL(B.ESTIMATED_PRIN_AMOUNT,0),
        NVL(B.ESTIMATED_INT_AMOUNT,0),
        NVL(B.ESTIMATED_COLL_AMOUNT,0),
        NVL(A.ESTIMATED_CF_AMOUNT,0),
        NVL(B.DISCOUNT_RATE,0),
        NVL(B.EIR,0),
        NVL(B.INTEREST_RATE,0),
        A.SEQ PV_MONTH,
        NVL(A.PV_ESTIMATED_CF_AMOUNT,0) PV_AMOUNT,
        0 ECL_AMOUNT,
        NVL(A.BEGINNING_CF_BALANCE,0) BEGIN_BALANCE,
        NVL(A.ESTIMATED_CF_PERCENT,0) INTEREST_UNWINDING,
        NVL(A.ENDING_CF_BALANCE,0) ENDING_BALANCE,
        NVL(A.UNWINDING_INCOME,0) UNWIND_BALANCE,
        B.CREATEDBY,
        B.CREATEDDATE,
        B.CREATEDHOST,
        B.UPDATEDBY,
        B.UPDATEDDATE,
        B.UPDATEDHOST
    FROM GTMP_TBLT_PAYMENTEXPECTED A
    JOIN GTMP_TBLU_DCF_BULK B
    ON A.ACCOUNT_NUMBER = B.ACCOUNT_NUMBER
    AND NVL(B.RESERVED_VARCHAR_1,' ') != 'ACCOUNT DETAIL UNCHANGED'
    UNION ALL
    SELECT
        B.OVERRIDEID,
        A.EFFECTIVE_DATE,
        A.CUSTOMER_NUMBER,
        A.FACILITY_NUMBER,
        A.ACCOUNT_NUMBER,
        A.MASTERID,
        A.CURRENCY,
        A.ESTIMATED_REALIZE_DATE,
        A.ESTIMATED_PRIN_AMOUNT,
        A.ESTIMATED_INT_AMOUNT,
        A.ESTIMATED_COLL_AMOUNT,
        A.ESTIMATED_AMOUNT,
        A.DISCOUNT_RATE,
        A.EIR,
        A.INTEREST_RATE,
        A.PV_MONTH,
        A.PV_AMOUNT,
        A.ECL_AMOUNT,
        A.BEGIN_BALANCE,
        A.INTEREST_UNWINDING,
        A.ENDING_BALANCE,
        A.UNWIND_BALANCE,
        A.CREATEDBY,
        A.CREATEDDATE,
        A.CREATEDHOST,
        A.UPDATEDBY,
        A.UPDATEDDATE,
        A.UPDATEDHOST
    FROM TBLT_PAYMENTEXPECTED A
    JOIN GTMP_TBLU_DCF_BULK B
    ON A.ACCOUNT_NUMBER = B.ACCOUNT_NUMBER
    AND NVL(B.RESERVED_VARCHAR_1,' ') = 'ACCOUNT DETAIL UNCHANGED'
    AND A.OVERRIDEID = TO_NUMBER(B.RESERVED_VARCHAR_2);
    COMMIT;

    INSERT INTO TBLT_PAYMENTEXPECTEDH
    (
        OVERRIDEID,
        EFFECTIVE_DATE,
        CUSTOMER_NUMBER,
        FACILITY_NUMBER,
        ACCOUNT_NUMBER,
        CURRENCY,
        OUTSTANDING,
        EAD,
        COLLATERAL_AMOUNT,
        PV_AMOUNT,
        ECL_AMOUNT,
        CREATEDBY,
        CREATEDDATE,
        CREATEDHOST,
        UPDATEDBY,
        UPDATEDDATE,
        UPDATEDHOST
    )
    SELECT OVERRIDEID,
        EFFECTIVE_DATE,
        ' ' CUSTOMER_NUMBER,
        ' ' FACILITY_NUMBER,
        A.ACCOUNT_NUMBER,
        A.CURRENCY,
        0 OUTSTANDING, --SUM(ESTIMATED_AMOUNT * NVL(B.RATE_AMOUNT,1)),
        0 EAD,
        0 COLLATERAL_AMOUNT,
        SUM(PV_AMOUNT),
        SUM(ECL_AMOUNT),
        CREATEDBY,
        CREATEDDATE,
        CREATEDHOST,
        UPDATEDBY,
        UPDATEDDATE,
        UPDATEDHOST
    FROM TBLT_PAYMENTEXPECTED A
    WHERE OVERRIDEID IN
    (SELECT OVERRIDEID FROM GTMP_TBLU_DCF_BULK)
    GROUP BY A.OVERRIDEID,
        A.EFFECTIVE_DATE,
        A.ACCOUNT_NUMBER,
        A.CURRENCY,
        A.CREATEDBY,
        A.CREATEDDATE,
        A.CREATEDHOST,
        A.UPDATEDBY,
        A.UPDATEDDATE,
        A.UPDATEDHOST;

    COMMIT;

    MERGE INTO TBLT_PAYMENTEXPECTEDH A
    USING
    (
        SELECT OVERRIDEID,
            ACCOUNT_NUMBER,
            OUTSTANDING
        FROM IFRS_IA_OVERRIDED
        WHERE OVERRIDEID IN
        (SELECT OVERRIDEID FROM GTMP_TBLU_DCF_BULK)
    ) B
    ON (A.OVERRIDEID = B.OVERRIDEID AND A.ACCOUNT_NUMBER = B.ACCOUNT_NUMBER)
    WHEN MATCHED THEN
    UPDATE SET
    A.OUTSTANDING = B.OUTSTANDING,
    A.EAD = B.OUTSTANDING;

    COMMIT;

    MERGE INTO TBLT_PAYMENTEXPECTEDH A
    USING
    (
        SELECT OVERRIDEID,
            ACCOUNT_NUMBER,
            SUM(PV_AMOUNT) SUM_PV_AMOUNT
        FROM TBLT_PAYMENTEXPECTED A3
        WHERE OVERRIDEID IN
        (SELECT OVERRIDEID FROM GTMP_TBLU_DCF_BULK)
        GROUP BY OVERRIDEID,
            ACCOUNT_NUMBER
    ) B
    ON (A.OVERRIDEID = B.OVERRIDEID AND A.ACCOUNT_NUMBER = B.ACCOUNT_NUMBER)
    WHEN MATCHED THEN
    UPDATE SET
    A.ECL_AMOUNT = A.EAD - B.SUM_PV_AMOUNT;

    COMMIT;

--    MERGE INTO TBLT_PAYMENTEXPECTEDH A
--    USING
--    (
--        SELECT A2.OVERRIDEID,
--            A2.ACCOUNT_NUMBER,
--            SUM(A2.ESTIMATED_AMOUNT * A2.EXCHANGE_RATE) AS OUTSTANDING
--        FROM
--        (
--            SELECT DISTINCT OVERRIDEID, ACCOUNT_NUMBER, ESTIMATED_AMOUNT, NVL(B3.RATE_AMOUNT,1) EXCHANGE_RATE
--            FROM TBLT_PAYMENTEXPECTED A3
--            LEFT JOIN (SELECT CURRENCY, RATE_AMOUNT FROM IFRS_MASTER_EXCHANGE_RATE WHERE DOWNLOAD_DATE = (SELECT CURRDATE FROM IFRS_PRC_DATE)) B3
--                ON A3.CURRENCY = B3.CURRENCY
--            WHERE OVERRIDEID IN
--            (SELECT OVERRIDEID FROM GTMP_TBLT_PAYMENTEXPECTED)
--        ) A2
--        GROUP BY A2.OVERRIDEID,
--            A2.ACCOUNT_NUMBER
--    ) B
--    ON (A.OVERRIDEID = B.OVERRIDEID AND A.ACCOUNT_NUMBER = B.ACCOUNT_NUMBER)
--    WHEN MATCHED THEN
--    UPDATE SET
--    A.OUTSTANDING = B.OUTSTANDING,
--    A.EAD = B.OUTSTANDING;

--    COMMIT;

--    MERGE INTO TBLT_PAYMENTEXPECTEDH A
--    USING
--    (
--        SELECT A2.OVERRIDEID,
--            A2.ACCOUNT_NUMBER,
--            SUM(A2.SUM_PV_AMOUNT) AS SUM_PV_AMOUNT
--        FROM
--        (
--            SELECT OVERRIDEID,
--                ACCOUNT_NUMBER,
--                SUM(PV_AMOUNT) * NVL(B3.RATE_AMOUNT,1) SUM_PV_AMOUNT
--            FROM TBLT_PAYMENTEXPECTED A3
--            LEFT JOIN (SELECT CURRENCY, RATE_AMOUNT FROM IFRS_MASTER_EXCHANGE_RATE WHERE DOWNLOAD_DATE = (SELECT CURRDATE FROM IFRS_PRC_DATE)) B3
--                ON A3.CURRENCY = B3.CURRENCY
--            WHERE OVERRIDEID IN
--            (SELECT OVERRIDEID FROM GTMP_TBLT_PAYMENTEXPECTED)
--            GROUP BY OVERRIDEID,
--                ACCOUNT_NUMBER,
--                RATE_AMOUNT
--        ) A2
--        GROUP BY A2.OVERRIDEID,
--            A2.ACCOUNT_NUMBER
--    ) B
--    ON (A.OVERRIDEID = B.OVERRIDEID AND A.ACCOUNT_NUMBER = B.ACCOUNT_NUMBER)
--    WHEN MATCHED THEN
--    UPDATE SET
--    A.ECL_AMOUNT = A.EAD - B.SUM_PV_AMOUNT;
--
--    COMMIT;

    INSERT INTO TBLT_PAYMENTEXPECTEDH_HIST
    (
        OVERRIDEID,
        EFFECTIVE_DATE,
        CUSTOMER_NUMBER,
        FACILITY_NUMBER,
        ACCOUNT_NUMBER,
        CURRENCY,
        OUTSTANDING,
        EAD,
        COLLATERAL_AMOUNT,
        PV_AMOUNT,
        ECL_AMOUNT,
        RESERVED_VARCHAR_1,
        RESERVED_VARCHAR_2,
        RESERVED_VARCHAR_3,
        RESERVED_VARCHAR_4,
        RESERVED_VARCHAR_5,
        RESERVED_AMOUNT_1,
        RESERVED_AMOUNT_2,
        RESERVED_AMOUNT_3,
        RESERVED_AMOUNT_4,
        RESERVED_AMOUNT_5,
        RESERVED_RATE_1,
        RESERVED_RATE_2,
        RESERVED_RATE_3,
        RESERVED_RATE_4,
        RESERVED_RATE_5,
        RESERVED_FLAG_1,
        RESERVED_FLAG_2,
        RESERVED_FLAG_3,
        RESERVED_FLAG_4,
        RESERVED_FLAG_5,
        RESERVED_DATE_1,
        RESERVED_DATE_2,
        RESERVED_DATE_3,
        RESERVED_DATE_4,
        RESERVED_DATE_5,
        CREATEDBY,
        CREATEDDATE,
        CREATEDHOST,
        UPDATEDBY,
        UPDATEDDATE,
        UPDATEDHOST
    )
    SELECT
        OVERRIDEID,
        EFFECTIVE_DATE,
        CUSTOMER_NUMBER,
        FACILITY_NUMBER,
        ACCOUNT_NUMBER,
        CURRENCY,
        OUTSTANDING,
        EAD,
        COLLATERAL_AMOUNT,
        PV_AMOUNT,
        ECL_AMOUNT,
        RESERVED_VARCHAR_1,
        RESERVED_VARCHAR_2,
        RESERVED_VARCHAR_3,
        RESERVED_VARCHAR_4,
        RESERVED_VARCHAR_5,
        RESERVED_AMOUNT_1,
        RESERVED_AMOUNT_2,
        RESERVED_AMOUNT_3,
        RESERVED_AMOUNT_4,
        RESERVED_AMOUNT_5,
        RESERVED_RATE_1,
        RESERVED_RATE_2,
        RESERVED_RATE_3,
        RESERVED_RATE_4,
        RESERVED_RATE_5,
        RESERVED_FLAG_1,
        RESERVED_FLAG_2,
        RESERVED_FLAG_3,
        RESERVED_FLAG_4,
        RESERVED_FLAG_5,
        RESERVED_DATE_1,
        RESERVED_DATE_2,
        RESERVED_DATE_3,
        RESERVED_DATE_4,
        RESERVED_DATE_5,
        CREATEDBY,
        CREATEDDATE,
        CREATEDHOST,
        UPDATEDBY,
        UPDATEDDATE,
        UPDATEDHOST
    FROM TBLT_PAYMENTEXPECTEDH
    WHERE OVERRIDEID IN
    (SELECT OVERRIDEID FROM GTMP_TBLU_DCF_BULK);

    COMMIT;

    INSERT INTO TBLT_PAYMENTEXPECTED_HIST
    (
        OVERRIDEID,
        EFFECTIVE_DATE,
        CUSTOMER_NUMBER,
        FACILITY_NUMBER,
        ACCOUNT_NUMBER,
        MASTERID,
        CURRENCY,
        ESTIMATED_REALIZE_DATE,
        ESTIMATED_PRIN_AMOUNT,
        ESTIMATED_INT_AMOUNT,
        ESTIMATED_COLL_AMOUNT,
        ESTIMATED_AMOUNT,
        DISCOUNT_RATE,
        EIR,
        INTEREST_RATE,
        PV_MONTH,
        PV_AMOUNT,
        ECL_AMOUNT,
        BEGIN_BALANCE,
        INTEREST_UNWINDING,
        ENDING_BALANCE,
        UNWIND_BALANCE,
        RESERVED_VARCHAR_1,
        RESERVED_VARCHAR_2,
        RESERVED_VARCHAR_3,
        RESERVED_VARCHAR_4,
        RESERVED_VARCHAR_5,
        RESERVED_AMOUNT_1,
        RESERVED_AMOUNT_2,
        RESERVED_AMOUNT_3,
        RESERVED_AMOUNT_4,
        RESERVED_AMOUNT_5,
        RESERVED_RATE_1,
        RESERVED_RATE_2,
        RESERVED_RATE_3,
        RESERVED_RATE_4,
        RESERVED_RATE_5,
        RESERVED_FLAG_1,
        RESERVED_FLAG_2,
        RESERVED_FLAG_3,
        RESERVED_FLAG_4,
        RESERVED_FLAG_5,
        RESERVED_DATE_1,
        RESERVED_DATE_2,
        RESERVED_DATE_3,
        RESERVED_DATE_4,
        RESERVED_DATE_5,
        CREATEDBY,
        CREATEDDATE,
        CREATEDHOST,
        UPDATEDBY,
        UPDATEDDATE,
        UPDATEDHOST
    )
    SELECT
        OVERRIDEID,
        EFFECTIVE_DATE,
        CUSTOMER_NUMBER,
        FACILITY_NUMBER,
        ACCOUNT_NUMBER,
        MASTERID,
        CURRENCY,
        ESTIMATED_REALIZE_DATE,
        ESTIMATED_PRIN_AMOUNT,
        ESTIMATED_INT_AMOUNT,
        ESTIMATED_COLL_AMOUNT,
        ESTIMATED_AMOUNT,
        DISCOUNT_RATE,
        EIR,
        INTEREST_RATE,
        PV_MONTH,
        PV_AMOUNT,
        ECL_AMOUNT,
        BEGIN_BALANCE,
        INTEREST_UNWINDING,
        ENDING_BALANCE,
        UNWIND_BALANCE,
        RESERVED_VARCHAR_1,
        RESERVED_VARCHAR_2,
        RESERVED_VARCHAR_3,
        RESERVED_VARCHAR_4,
        RESERVED_VARCHAR_5,
        RESERVED_AMOUNT_1,
        RESERVED_AMOUNT_2,
        RESERVED_AMOUNT_3,
        RESERVED_AMOUNT_4,
        RESERVED_AMOUNT_5,
        RESERVED_RATE_1,
        RESERVED_RATE_2,
        RESERVED_RATE_3,
        RESERVED_RATE_4,
        RESERVED_RATE_5,
        RESERVED_FLAG_1,
        RESERVED_FLAG_2,
        RESERVED_FLAG_3,
        RESERVED_FLAG_4,
        RESERVED_FLAG_5,
        RESERVED_DATE_1,
        RESERVED_DATE_2,
        RESERVED_DATE_3,
        RESERVED_DATE_4,
        RESERVED_DATE_5,
        CREATEDBY,
        CREATEDDATE,
        CREATEDHOST,
        UPDATEDBY,
        UPDATEDDATE,
        UPDATEDHOST
    FROM TBLT_PAYMENTEXPECTED
    WHERE OVERRIDEID IN
    (SELECT OVERRIDEID FROM GTMP_TBLU_DCF_BULK);

    COMMIT;
END;