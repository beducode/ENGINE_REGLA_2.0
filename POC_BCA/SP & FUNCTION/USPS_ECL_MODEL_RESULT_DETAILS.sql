CREATE OR REPLACE PROCEDURE USPS_ECL_MODEL_RESULT_DETAILS
(
    V_ECL_MASTERID NUMBER DEFAULT 0,
    V_ECL_PERIOD DATE DEFAULT '1900-01-01',
    V_ECL_MODEL_ID NUMBER DEFAULT 0,
    Cur_out OUT SYS_REFCURSOR
)
AS
BEGIN

    OPEN Cur_out FOR

    SELECT
        A.DOWNLOAD_DATE,
        A.FL_YEAR,
        B.ACCOUNT_NUMBER,
        ROUND(A.PD_RATE * 100,6 ) PD_RATE,
        ROUND(A.LGD_RATE * 100,6 ) LGD_RATE,
        NVL(A.FAIR_VALUE_AMOUNT,0) * NVL(B.EXCHANGE_RATE,1) AS FAIR_VALUE_AMOUNT,
        NVL(A.INTEREST_ACCRUED,0)  * NVL(B.EXCHANGE_RATE,1) AS INTEREST_ACCRUED,
        NVL(A.PREPAYMENT_AMOUNT,0)  * NVL(B.EXCHANGE_RATE,1) AS PREPAYMENT_AMOUNT,
        NVL(A.CCF_AMOUNT,0)  * NVL(B.EXCHANGE_RATE,1) AS CCF_AMOUNT,
        NVL(A.EAD_AMOUNT,0)  * NVL(B.EXCHANGE_RATE,1) AS EAD_AMOUNT,
        NVL(A.ECL_AMOUNT,0)  * NVL(B.EXCHANGE_RATE,1) AS ECL_AMOUNT,
        ROUND(A.DISCOUNT_RATE, 6) AS DISCOUNT_RATE
    FROM IFRS_ECL_RESULT_DETAIL_CALC A
    INNER JOIN IFRS_ECL_RESULT_DETAIL B
    ON A.ECL_MODEL_ID = B.ECL_MODEL_ID
    AND A.DOWNLOAD_DATE = B.DOWNLOAD_DATE
    AND A.MASTERID = B.MASTERID
    WHERE A.DOWNLOAD_DATE = V_ECL_PERIOD
    AND A.ECL_MODEL_ID = V_ECL_MODEL_ID
    AND A.MASTERID = V_ECL_MASTERID
    ORDER BY A.COUNTER_PAYSCHD;

END;